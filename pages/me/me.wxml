<navigation-bar title="我的" back="{{false}}" color="black" background="#f8fbff"></navigation-bar>

<view class="page">
  <view class="card profile">
    <view wx:if="{{currentUser}}">
      <view class="name-row">
        <view class="name">{{currentUser.nickname}}</view>
        <view wx:if="{{isAdmin}}" class="role-tag">管理员</view>
      </view>
      <view class="meta">手机号：{{currentUser.phone}}</view>
    </view>
    <view wx:else>
      <view class="name">未登录</view>
      <view class="meta">登录后可管理借用记录和聊天</view>
    </view>
  </view>

  <view class="stats">
    <view class="card stat">
      <view class="value">{{stats.itemCount}}</view>
      <view class="label">平台物品</view>
    </view>
    <view class="card stat">
      <view class="value">{{stats.sessionCount}}</view>
      <view class="label">我的会话</view>
    </view>
  </view>

  <view class="card actions">
    <button wx:if="{{!currentUser}}" class="auth-btn" bindtap="goAuth">登录 / 注册</button>
    <button wx:if="{{currentUser}}" class="msg-btn" bindtap="goMessages">查看信息</button>
    <button wx:if="{{currentUser}}" class="logout-btn" bindtap="logout">退出登录</button>
  </view>

  <view wx:if="{{currentUser}}" class="card manage">
    <view class="manage-title">{{isAdmin ? '帖子管理（管理员）' : '我的发布管理'}}</view>

    <view class="sub-title">出借帖子</view>
    <view wx:if="{{manageItems.length === 0}}" class="empty">暂无出借帖子</view>
    <view wx:for="{{manageItems}}" wx:key="id" class="manage-item">
      <view class="manage-head">
        <view class="manage-name">{{item.title}}</view>
        <view class="manage-status {{item.isHidden ? 'hidden' : ''}}">{{item.isHidden ? '已隐藏' : item.status}}</view>
      </view>
      <view class="manage-meta">{{item.owner}} · {{item.category}} · {{item.location}}</view>
      <view wx:if="{{item.isHidden && item.hiddenReason}}" class="manage-reason">隐藏原因：{{item.hiddenReason}}</view>
      <button class="manage-btn" size="mini" data-id="{{item.id}}" bindtap="handleItemAction">管理</button>
    </view>

    <view class="sub-title">求借帖子</view>
    <view wx:if="{{manageDemands.length === 0}}" class="empty">暂无求借帖子</view>
    <view wx:for="{{manageDemands}}" wx:key="id" class="manage-item">
      <view class="manage-head">
        <view class="manage-name">{{item.title}}</view>
        <view class="manage-status {{item.isHidden ? 'hidden' : ''}}">{{item.isHidden ? '已隐藏' : item.status}}</view>
      </view>
      <view class="manage-meta">{{item.publisher}} · {{item.category}} · {{item.location}}</view>
      <view wx:if="{{item.isHidden && item.hiddenReason}}" class="manage-reason">隐藏原因：{{item.hiddenReason}}</view>
      <button class="manage-btn" size="mini" data-id="{{item.id}}" bindtap="handleDemandAction">管理</button>
    </view>
  </view>
</view>
